<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Professional Task Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { background-color: #f8f9fa; }
  .card { margin-bottom: 1rem; }
  .scrollable { max-height: 600px; overflow-y: auto; padding-right: 5px; }
</style>
</head>
<body>
<div class="container-fluid py-4">
  <h1 class="mb-4 text-center">üìä My Task Dashboard</h1>
  <div class="row gx-4">
    <!-- Column 1: Issues -->
    <div class="col-lg-3 col-md-6">
      <h4>üõ† Issues Assigned</h4>
      <div id="issues" class="scrollable"></div>
    </div>

    <!-- Column 2: Reviews -->
    <div class="col-lg-3 col-md-6">
      <h4>üîç Reviews Needed</h4>
      <div id="reviews" class="scrollable"></div>
    </div>

    <!-- Column 3: Schedule -->
    <div class="col-lg-3 col-md-6">
      <h4>üìÖ Schedule</h4>
      <div id="schedule" class="scrollable"></div>
    </div>

    <!-- Column 4: AI Assistant -->
    <div class="col-lg-3 col-md-6">
      <h4>ü§ñ AI Assistant</h4>
      <div id="assistant" class="scrollable"></div>
    </div>
  </div>

  <!-- Charts -->
  <div class="row mt-4">
    <div class="col-md-6">
      <h5>Issues by Severity</h5>
      <canvas id="issuesChart"></canvas>
    </div>
    <div class="col-md-6">
      <h5>Reviews Pending</h5>
      <canvas id="reviewsChart"></canvas>
    </div>
  </div>
</div>

<script>
async function loadData() {
  // Replace with your real FastAPI endpoints:
   const data1 = await fetch('http://localhost:8000/api/jira/').then(r => r.json());
   const data2 = await fetch('http://localhost:8000/api/review-board/').then(r => r.json());
   const data3 = await fetch('http://localhost:8000/api/meetings/').then(r => r.json());
   const data4 = await fetch('http://localhost:8000/api/taskscheduler/').then(r => r.json());

  // Sample data
//   const data1 = [
//     {'Issue Key': 'LSN-49347', 'Summary': 'MSPW service activation fail...', 'issuetype': 'PR', 'status': 'Handling', 'Severity': 'Major'},
//     {'Issue Key': 'LSN-49348', 'Summary': 'Login fails intermittently...', 'issuetype': 'Bug', 'status': 'Open', 'Severity': 'Critical'}
//   ];

//   const data2 = [
//     {'id': 45100, 'description': 'Negative SOP values not shown...', 'submitter': 'vabhatia', 'reviewers': ['abverma','akumari'], 'due_date': '2025-09-17'}
//   ];

//   const data3 = [
//     {'subject': 'TASKIT', 'start': '12:00 PM', 'end': '12:30 PM', 'date': 'Today', 'location': 'Teams', 'organizer': 'Ramona Jacob', 'Attendees_list': ['Ramona Jacob','Kuravalli']}
//   ];

//   const data4 = [
//     {'task_type': 'Jira', 'summary': 'Export of Current Alarms File fails...', 'task_id': 'LSN-56444', 'severity': 'Critical', 'stopper': 'MKT Stopper', 'start_time': '2025-09-16T13:00:00Z', 'end_time': '2025-09-16T16:00:00Z'}
//   ];

  // --- Render API 1: Issues with collapsible card ---
  const issuesDiv = document.getElementById('issues');
  issuesDiv.innerHTML = data1.map((issue, idx) => `
    <div class="card shadow-sm">
      <div class="card-header" data-bs-toggle="collapse" data-bs-target="#issue${idx}" style="cursor:pointer">
        <strong>${issue['Issue Key']}</strong> <span class="badge bg-${issue.Severity==='Critical'?'danger':issue.Severity==='Major'?'warning':'success'}">${issue.Severity}</span>
        <span class="badge bg-info text-dark">${issue.status}</span>
      </div>
      <div id="issue${idx}" class="collapse card-body">
        ${issue.Summary}<br>
        Type: ${issue.issuetype}
      </div>
    </div>
  `).join('');

  // --- Render API 2: Reviews ---
  const reviewsDiv = document.getElementById('reviews');
  reviewsDiv.innerHTML = data2.map((r, idx) => `
    <div class="card shadow-sm">
      <div class="card-header" data-bs-toggle="collapse" data-bs-target="#review${idx}" style="cursor:pointer">
        <strong>ID ${r.id}</strong> <span class="badge bg-secondary">Due: ${r.due_date}</span>
      </div>
      <div id="review${idx}" class="collapse card-body">
        ${r.description}<br>
        Submitter: ${r.submitter}<br>
        Reviewers: ${r.reviewers.join(', ')}
      </div>
    </div>
  `).join('');

  // --- Render API 3: Schedule ---
  const scheduleDiv = document.getElementById('schedule');
  scheduleDiv.innerHTML = data3.map(s => `
    <div class="card shadow-sm">
      <div class="card-body">
        <strong>${s.subject}</strong><br>
        ${s.date} | ${s.start}-${s.end}<br>
        ${s.location}<br>
        Organizer: ${s.organizer}<br>
        Attendees: ${s.Attendees_list.join(', ')}
      </div>
    </div>
  `).join('');

  // --- Render API 4: AI Assistant ---
    const assistantDiv = document.getElementById('assistant');

    assistantDiv.innerHTML = data4.map((a, idx) => {
    let cardBodyContent = '';
    let badgeSeverity = '';
    let cardBorderClass = 'border-primary'; // Default border color

    // Set card border color based on task type or severity
    if (a.task_type === 'Jira') {
        if (a.severity === 'Critical') {
        cardBorderClass = 'border-danger';
        } else if (a.severity === 'Major') {
        cardBorderClass = 'border-warning';
        } else {
        cardBorderClass = 'border-info'; // Default for Jira with no or minor severity
        }
    } else if (a.task_type === 'Meeting') {
        cardBorderClass = 'border-success';
    } else if (a.task_type === 'Review') {
        cardBorderClass = 'border-secondary';
    } else if (a.task_type === 'Break') {
        cardBorderClass = 'border-light'; // A lighter border for breaks
    }


    // Conditional content for the card body
    if (a.task_type === 'Jira') {
        badgeSeverity = a.severity ? `<span class="badge ${a.severity === 'Critical' ? 'bg-danger' : a.severity === 'Major' ? 'bg-warning text-dark' : 'bg-info'}">${a.severity}</span>` : 'N/A';
        cardBodyContent = `
        ${a.summary}<br>
        <strong>Task ID:</strong> ${a.task_id}<br>
        <strong>Severity:</strong> ${badgeSeverity}<br>
        <strong>Stopper:</strong> ${a.stopper || 'N/A'}<br>
        `;
    } else if (a.task_type === 'Review') {
        cardBodyContent = `
        ${a.summary}<br>
        <strong>Task ID:</strong> ${a.task_id}<br>
        <strong>Due Date:</strong> ${a.due_date}<br>
        `;
    } else if (a.task_type === 'Meeting') {
        cardBodyContent = `
        ${a.summary}<br>
        <strong>Organizer:</strong> ${a.organizer}<br>
        `;
    } else if (a.task_type === 'Break') {
        cardBodyContent = `
        ${a.summary}<br>
        Enjoy your break!
        `;
    }

    return `
        <div class="card shadow-sm mb-3 ${cardBorderClass}">
        <div class="card-header" data-bs-toggle="collapse" data-bs-target="#assistant${idx}" style="cursor:pointer">
            <strong>${a.task_type}</strong> ${a.task_type === 'Jira' && a.severity ? badgeSeverity : ''}<br>
            <small>${a.start_time} - ${a.end_time}</small>
        </div>
        <div id="assistant${idx}" class="collapse card-body">
            ${cardBodyContent}
        </div>
        </div>
    `;
    }).join('');

  // --- Charts ---
  const issuesSeverity = data1.reduce((acc,i)=>{ acc[i.Severity] = (acc[i.Severity]||0)+1; return acc; }, {});
  new Chart(document.getElementById('issuesChart'), {
    type: 'doughnut',
    data: {
      labels: Object.keys(issuesSeverity),
      datasets: [{data: Object.values(issuesSeverity), backgroundColor:['#dc3545','#ffc107','#198754']}]
    }
  });

  const reviewsCount = data2.length;
  new Chart(document.getElementById('reviewsChart'), {
    type: 'bar',
    data: {
      labels: ['Reviews Pending'],
      datasets: [{label: 'Count', data: [reviewsCount], backgroundColor:'#0d6efd'}]
    },
    options: {indexAxis:'y', scales:{x:{beginAtZero:true}}}
  });
}

// Load everything
loadData();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>